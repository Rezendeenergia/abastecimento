<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Rezende Energia - Gest√£o de Abastecimento</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #F7931E 0%, #ff6b35 50%, #d4761a 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Login Screen */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #F7931E 0%, #ff6b35 50%, #d4761a 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .login-card {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        .login-logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #F7931E 0%, #ff6b35 100%);
            border-radius: 15px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .login-logo::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(45deg);
            width: 40px;
            height: 40px;
            background: white;
            clip-path: polygon(0% 0%, 70% 0%, 100% 30%, 100% 100%, 30% 100%, 0% 70%);
        }

        .login-logo::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(45deg);
            width: 32px;
            height: 32px;
            background: #1a1a1a;
            clip-path: polygon(30% 0%, 100% 0%, 100% 70%, 70% 100%, 0% 100%, 0% 30%);
            z-index: 1;
        }

        .login-title {
            font-size: 1.8em;
            color: #1e293b;
            margin-bottom: 10px;
        }

        .login-subtitle {
            color: #64748b;
            margin-bottom: 30px;
        }

        .role-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .role-btn {
            background: linear-gradient(135deg, #F7931E 0%, #ff6b35 100%);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(247, 147, 30, 0.3);
        }

        .role-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(247, 147, 30, 0.4);
        }

        .role-btn.supervisor {
            background: linear-gradient(135deg, #1a1a1a 0%, #404040 100%);
            box-shadow: 0 4px 12px rgba(26, 26, 26, 0.3);
        }

        .role-btn.supervisor:hover {
            box-shadow: 0 8px 25px rgba(26, 26, 26, 0.4);
        }

        .supervisor-login {
            display: none;
            margin-top: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 15px;
            text-align: left;
        }

        .form-group label {
            font-weight: 500;
            color: #374151;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            width: 100%;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #F7931E;
            box-shadow: 0 0 0 3px rgba(247, 147, 30, 0.1);
        }

        .header {
            background: linear-gradient(135deg, #F7931E 0%, #ff6b35 50%, #d4761a 100%);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 6px rgba(247, 147, 30, 0.2);
        }

        .logo h1 {
            font-size: 1.8em;
            font-weight: bold;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-role {
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .logout-btn {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }

        .nav-bar {
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            padding: 0;
            display: flex;
            overflow-x: auto;
        }

        .nav-item {
            padding: 15px 25px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            white-space: nowrap;
            font-weight: 500;
            color: #64748b;
        }

        .nav-item:hover {
            background: #e2e8f0;
            color: #1e293b;
        }

        .nav-item.active {
            background: white;
            border-bottom-color: #F7931E;
            color: #F7931E;
        }

        .nav-item.hidden {
            display: none;
        }

        .main-content {
            flex: 1;
            padding: 30px;
            background: #f8fafc;
        }

        .screen {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .screen.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            margin-bottom: 25px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f1f5f9;
        }

        .card-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #1e293b;
        }

        .btn {
            background: linear-gradient(135deg, #F7931E 0%, #ff6b35 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(247, 147, 30, 0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(247, 147, 30, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 12px;
        }

        .table-container {
            overflow-x: auto;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #f1f5f9;
        }

        th {
            background: #f8fafc;
            font-weight: 600;
            color: #374151;
        }

        tr:hover {
            background: #f8fafc;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .status-pending {
            background: linear-gradient(135deg, #F7931E 0%, #ff6b35 100%);
            color: white;
        }

        .status-signed {
            background: #d1fae5;
            color: #065f46;
        }

        .status-fueled {
            background: #dbeafe;
            color: #1e40af;
        }

        .status-completed {
            background: linear-gradient(135deg, #1a1a1a 0%, #404040 100%);
            color: white;
        }

        .status-rejected {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            border-left: 5px solid;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.12);
        }

        .stat-card.pending {
            border-left-color: #F7931E;
            background: linear-gradient(135deg, rgba(247, 147, 30, 0.05) 0%, rgba(255, 107, 53, 0.05) 100%);
        }
        .stat-card.signed {
            border-left-color: #10b981;
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.05) 0%, rgba(5, 150, 105, 0.05) 100%);
        }
        .stat-card.fueled {
            border-left-color: #3b82f6;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(37, 99, 235, 0.05) 100%);
        }
        .stat-card.completed {
            border-left-color: #1a1a1a;
            background: linear-gradient(135deg, rgba(26, 26, 26, 0.05) 0%, rgba(64, 64, 64, 0.05) 100%);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-card.pending .stat-number { color: #F7931E; }
        .stat-card.signed .stat-number { color: #10b981; }
        .stat-card.fueled .stat-number { color: #3b82f6; }
        .stat-card.completed .stat-number { color: #1a1a1a; }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 24px;
            cursor: pointer;
            color: #64748b;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .action-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.08);
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border-top: 4px solid #F7931E;
        }

        .action-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(247, 147, 30, 0.15);
        }

        .action-icon {
            font-size: 3em;
            margin-bottom: 15px;
            color: #F7931E;
        }

        .action-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 10px;
        }

        .action-desc {
            color: #64748b;
            font-size: 0.9em;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
            z-index: 1001;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }

        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }

        .notification.error {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .notification.warning {
            background: linear-gradient(135deg, #F7931E 0%, #ff6b35 100%);
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 15px;
            }
            .form-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="login-screen" class="login-screen">
        <div class="login-card">
            <div class="login-logo"></div>
            <h2 class="login-title">Rezende Energia</h2>
            <p class="login-subtitle">Sistema de Gest√£o de Abastecimento</p>

            <div class="role-buttons" id="role-selection">
                <button class="role-btn" onclick="loginAsDriver()">üöõ Entrar como Motorista</button>
                <button class="role-btn supervisor" onclick="showSupervisorLogin()">üë®‚Äçüíº Entrar como Supervisor</button>
            </div>

            <div class="supervisor-login" id="supervisor-login">
                <div class="form-group">
                    <label>Usu√°rio:</label>
                    <input type="text" id="supervisor-username" placeholder="Digite seu usu√°rio">
                </div>
                <div class="form-group">
                    <label>Senha:</label>
                    <input type="password" id="supervisor-password" placeholder="Digite sua senha">
                </div>
                <button class="role-btn supervisor" onclick="loginAsSupervisor()">Entrar</button>
                <button class="role-btn" style="margin-top: 10px; background: #64748b;" onclick="backToRoleSelection()">Voltar</button>
            </div>
        </div>
    </div>

    <div class="container" id="main-app" style="display: none;">
        <div class="header">
            <div class="logo">
                <h1>Rezende Energia</h1>
            </div>
            <div class="user-info">
                <span class="user-role" id="user-role-display"></span>
                <span id="current-date"></span>
                <button class="logout-btn" onclick="logout()">Sair</button>
            </div>
        </div>

        <div class="nav-bar">
            <div class="nav-item active" onclick="showScreen('dashboard')">üìä Dashboard</div>
            <div class="nav-item" onclick="showScreen('requests')">üìã Requisi√ß√µes</div>
            <div class="nav-item hidden" id="nav-vehicles" onclick="showScreen('vehicles')">üöö Ve√≠culos</div>
        </div>

        <div class="main-content">
            <div id="dashboard" class="screen active">
                <div class="quick-actions">
                    <div class="action-card" onclick="newRequest()">
                        <div class="action-icon">üìã</div>
                        <div class="action-title">Nova Requisi√ß√£o</div>
                        <div class="action-desc">Solicitar abastecimento de ve√≠culo</div>
                    </div>
                    <div class="action-card" onclick="exportToExcel()" id="action-export" style="display: none;">
                        <div class="action-icon">üìä</div>
                        <div class="action-title">Exportar Excel</div>
                        <div class="action-desc">Gerar relat√≥rio completo</div>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card pending" onclick="filterByStatus('pending')">
                        <div class="stat-number" id="stat-pending">0</div>
                        <div class="stat-label">Pendentes</div>
                    </div>
                    <div class="stat-card signed" onclick="filterByStatus('signed')">
                        <div class="stat-number" id="stat-signed">0</div>
                        <div class="stat-label">Aprovadas</div>
                    </div>
                    <div class="stat-card fueled" onclick="filterByStatus('fueled')">
                        <div class="stat-number" id="stat-fueled">0</div>
                        <div class="stat-label">Abastecimentos</div>
                    </div>
                    <div class="stat-card completed" onclick="filterByStatus('completed')">
                        <div class="stat-number" id="stat-completed">0</div>
                        <div class="stat-label">Completas</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üìã Atividades Recentes</div>
                        <button class="btn" onclick="showScreen('requests')">Ver Todas</button>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Motorista</th>
                                    <th>Ve√≠culo</th>
                                    <th>Status</th>
                                    <th>Data</th>
                                    <th id="actions-header">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="recent-activities">
                                <tr><td colspan="6" style="text-align: center; padding: 40px;">Nenhuma requisi√ß√£o ainda</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="requests" class="screen">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üìã Gest√£o de Requisi√ß√µes</div>
                        <button class="btn" onclick="newRequest()">‚ûï Nova Requisi√ß√£o</button>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Motorista</th>
                                    <th>Ve√≠culo</th>
                                    <th>Cidade</th>
                                    <th>Status</th>
                                    <th>Data</th>
                                    <th id="requests-actions-header">A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="all-requests">
                                <tr><td colspan="7" style="text-align: center; padding: 40px;">Nenhuma requisi√ß√£o ainda</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="vehicles" class="screen">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">üöö Gest√£o de Ve√≠culos</div>
                        <button class="btn" onclick="newVehicle()">‚ûï Novo Ve√≠culo</button>
                    </div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Placa</th>
                                    <th>Modelo</th>
                                    <th>Ano</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="vehicles-list">
                                <tr><td colspan="4" style="text-align: center; padding: 40px;">Carregando ve√≠culos...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-new-request" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('modal-new-request')">&times;</span>
            <h2 style="margin-bottom: 20px;">üìã Nova Requisi√ß√£o de Abastecimento</h2>

            <div class="form-grid">
                <div class="form-group">
                    <label>Motorista: *</label>
                    <select id="new-request-driver">
                        <option value="">Selecione seu nome</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Placa do Ve√≠culo: *</label>
                    <select id="new-request-plate" onchange="updateVehicleModel()">
                        <option value="">Selecione</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Modelo:</label>
                    <input type="text" id="new-request-vehicle-model" readonly>
                </div>
                <div class="form-group">
                    <label>Cidade: *</label>
                    <select id="new-request-city">
                        <option value="">Selecione</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Posto: *</label>
                    <select id="new-request-gas-station">
                        <option value="">Selecione</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Combust√≠vel: *</label>
                    <select id="new-request-fuel-type">
                        <option value="">Selecione</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Quilometragem: *</label>
                    <input type="number" id="new-request-km" placeholder="85000">
                </div>
                <div class="form-group" style="grid-column: 1 / -1;">
                    <label>Observa√ß√µes:</label>
                    <textarea id="new-request-notes" rows="3" placeholder="Informa√ß√µes adicionais..."></textarea>
                </div>
            </div>

            <div style="margin-top: 25px; display: flex; gap: 15px; justify-content: flex-end;">
                <button class="btn btn-secondary" onclick="closeModal('modal-new-request')">Cancelar</button>
                <button class="btn" onclick="createRequest()">‚úÖ Criar Requisi√ß√£o</button>
            </div>
        </div>
    </div>

    <div id="modal-new-vehicle" class="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal('modal-new-vehicle')">&times;</span>
            <h2 style="margin-bottom: 20px;">üöö Cadastrar Novo Ve√≠culo</h2>

            <div class="form-grid">
                <div class="form-group">
                    <label>Placa:</label>
                    <input type="text" id="new-vehicle-plate" placeholder="ABC-1234" style="text-transform: uppercase;">
                </div>
                <div class="form-group">
                    <label>Modelo:</label>
                    <input type="text" id="new-vehicle-model" placeholder="Toyota Hilux">
                </div>
                <div class="form-group">
                    <label>Ano:</label>
                    <input type="number" id="new-vehicle-year" placeholder="2023">
                </div>
                <div class="form-group">
                    <label>Cor:</label>
                    <input type="text" id="new-vehicle-color" placeholder="Branca">
                </div>
            </div>

            <div style="margin-top: 25px; display: flex; gap: 15px; justify-content: flex-end;">
                <button class="btn btn-secondary" onclick="closeModal('modal-new-vehicle')">Cancelar</button>
                <button class="btn" onclick="createVehicle()">‚úÖ Cadastrar</button>
            </div>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        console.log('üöÄ Iniciando Sistema Rezende Energia v3.2.0');

        // DADOS GLOBAIS
        let currentRole = '';
        let isLoggedIn = false;
        let currentDriverName = '';
        let requests = [];
        let vehicles = [];
        let fuelRecords = [];

        const availableDrivers = [
            'ABRA√ÉO TRINDADE ALBUQUERQUE', 'AIRTON VINICIUS DOS SANTOS OLIVEIRA',
            'ALAN DENNER PINTO DE SOUZA', 'ALESSANDRO OZITIO CAMPELO',
            'ARLISON NESTOR DA CONCEI√á√ÉO', 'CARLOS ALBERTO DOS SANTOS',
            'CIDARTA REGIS DE SOUZA', 'DANIEL PINTO PEDROSO',
            'DARLEN WILSON FERREIRA SILVA', 'DINEY RODRIGUES DOS PASSOS',
            'EDER JUNIOR PAPALEO DA SILVA', 'EDINEI DA SILVA FERREIRA',
            'EDUARDO PINHEIRO RODRIGUES', 'HELIO BARBOSA COSTA',
            'JACKSOM AMARAL DA SILVA', 'JANILDO PORTILHO SANTOS FILHO',
            'JO√ÉO BATISTA DA SILVA BEZERRA', 'JOELSON MONTEIRO PEREIRA',
            'JOSIVAN MACIEL DOS REIS', 'JUAN FABRICIO RODRIGUES DE LIMA',
            'JUNIPERO MANOEL DA SILVA LOPES', 'KLEBER JOSE DOS SANTOS PEREIRA',
            'MARCIO FERREIRA SABOIA', 'MARCOS ANDRE MENDES PEREIRA',
            'MARIVALDO DE JESUS CORREA', 'MARLISSON FEITOSA BEZERRA',
            'MATHEUS TRINDADE DE ALMEIDA', 'MICHAEL LUAN DOS SANTOS SILVA',
            'NILTON MARCOS MOTA CAMPOS', 'RENILDO FERREIRA LAVAREDA',
            'RIAN TEIXEIRA SIQUEIRA', 'ROM√ÅRIO LIMA RIKER',
            'LEONARDO NANTES ALVES', 'JARLISSON FABIO SANTOS DE SOUSA',
            'PEDRO HUEB TAPXURE CURRY', 'RAFAEL REZENDE DA SILVA'
        ];

        const cities = [
            'Santar√©m', 'Moju√≠ dos Campos', 'Lago Grande', 'Vila Gorete',
            'Juruti', 'Almeirim', 'Barcarena', 'Itaituba', 'Curuai',
            'Vila Brasil', 'Membeca', 'Ilha das On√ßas'
        ];

        const gasStations = [
            'Posto Leal (Itaituba)', 'Posto Top√°zio (Juruti)',
            'Posto Nossa Senhora de Nazar√© (Curua√≠)', 'Posto Amanhecer (Barcarena)',
            'Posto Equador (Frente da base)', 'Posto Equador (Muiraquit√£ com Turiano)',
            'Auto Amanhecer (Muiraquit√£ Frente a Base)', 'Posto Petrog√°s (Almerim)',
            'Posto S√£o Jo√£o (Moju√≠)'
        ];

        const fuelTypes = [
            'Diesel S10', 'Diesel Comum', 'Gasolina Comum',
            'Gasolina Aditivada', 'Etanol', 'GNV'
        ];

        const initialVehicles = [
            { plate: 'BCQ0937', model: 'F4000', year: '2023', status: 'Ativo', color: 'Branca' },
            { plate: 'JJB4E57', model: 'CARGO 1217', year: '2002', status: 'Ativo', color: 'Branco' },
            { plate: 'NCF3078', model: 'L200 OUTDOOR', year: '2004', status: 'Ativo', color: 'Prata' },
            { plate: 'NFW2H74', model: 'CARGO 1317F', year: '2002', status: 'Ativo', color: 'Branco' },
            { plate: 'NRP2E59', model: 'L200 TRITON 3.2 D', year: '2016', status: 'Ativo', color: 'Prata' },
            { plate: 'OFP1B78', model: '13.190 CRM 4X2', year: '2020', status: 'Ativo', color: 'Branco' },
            { plate: 'OGI3J31', model: 'L200 TRITON 3.2 D', year: '2016', status: 'Ativo', color: 'Branco' },
            { plate: 'OLI7180', model: 'L200 TRITON GLS D', year: '2016', status: 'Ativo', color: 'Branco' },
            { plate: 'PHK5D53', model: 'STRADA FREEDOM CD13', year: '2022', status: 'Ativo', color: 'Prata' },
            { plate: 'PHL2H91', model: 'S10 LT', year: '2016', status: 'Ativo', color: 'Branco' },
            { plate: 'PHL8286', model: 'STRADA FREEDOM CD13', year: '2014', status: 'Ativo', color: 'Prata' },
            { plate: 'RXE8A01', model: 'SAVEIRO CS RB MF', year: '2018', status: 'Ativo', color: 'Branco' },
            { plate: 'PVA2J86', model: 'SAVEIRO CS RB MF', year: '2016', status: 'Ativo', color: 'Prata' },
            { plate: 'SHF6D51', model: 'TECTOR 170E21', year: '2023', status: 'Ativo', color: 'Branco' },
            { plate: 'SHK5E03', model: 'TECTOR 170E21', year: '2023', status: 'Ativo', color: 'Branco' },
            { plate: 'SYN1C01', model: 'TECTOR 170E21', year: '2023', status: 'Ativo', color: 'Branco' },
            { plate: 'TAU9G16', model: '17.210 CRM 4X2', year: '2024', status: 'Ativo', color: 'Branco' },
            { plate: 'TAU9G17', model: '17.210 CRM 4X2', year: '2024', status: 'Ativo', color: 'Branco' },
            { plate: 'TDT0133', model: 'STRADA FREEDOM CD13', year: '2022', status: 'Ativo', color: 'Branco' },
            { plate: 'TDT3G89', model: 'STRADA FREEDOM CD13', year: '2022', status: 'Ativo', color: 'Branco' },
            { plate: 'TDT3H12', model: 'STRADA FREEDOM CD13', year: '2022', status: 'Ativo', color: 'Branco' },
            { plate: 'TDT3H26', model: 'STRADA FREEDOM CD13', year: '2022', status: 'Ativo', color: 'Branco' },
            { plate: 'CATAMAR√É 1', model: 'CATAMAR√É', year: '2023', status: 'Ativo', color: 'Branca' },
            { plate: 'CATAMAR√É 2', model: 'CATAMAR√É', year: '2023', status: 'Ativo', color: 'Branca' },
            { plate: 'RETROESCAVADEIRA 1', model: 'RETROESCAVADEIRA', year: '2023', status: 'Ativo', color: 'Branca' },
            { plate: 'RETROESCAVADEIRA 2', model: 'RETROESCAVADEIRA', year: '2023', status: 'Ativo', color: 'Branca' },
            { plate: 'RETROESCAVADEIRA 3', model: 'RETROESCAVADEIRA', year: '2023', status: 'Ativo', color: 'Branca' },
            { plate: 'QZK5H16', model: 'S10 LTZ', year: '2024', status: 'Ativo', color: 'PRETA' },
            { plate: 'TGM0373', model: 'HILUX SRX', year: '2022', status: 'Ativo', color: 'PRETA' },
            { plate: 'QVN99H33', model: 'HB20', year: '2022', status: 'Ativo', color: 'BRANCA' }
        ];

        // FUN√á√ïES DE ARMAZENAMENTO
        function saveData() {
            try {
                const data = {
                    requests: requests,
                    vehicles: vehicles,
                    fuelRecords: fuelRecords,
                    lastSave: new Date().toISOString()
                };
                localStorage.setItem('rezende-energia-data', JSON.stringify(data));
                console.log('üíæ Dados salvos:', {
                    requisicoes: requests.length,
                    veiculos: vehicles.length
                });
                return true;
            } catch (e) {
                console.error('‚ùå Erro ao salvar:', e);
                showNotification('Erro ao salvar dados!', 'error');
                return false;
            }
        }

        function loadData() {
            try {
                const saved = localStorage.getItem('rezende-energia-data');
                if (saved) {
                    const data = JSON.parse(saved);
                    requests = data.requests || [];
                    vehicles = data.vehicles || [...initialVehicles];
                    fuelRecords = data.fuelRecords || [];
                    console.log('‚úÖ Dados carregados:', {
                        requisicoes: requests.length,
                        veiculos: vehicles.length
                    });
                } else {
                    vehicles = [...initialVehicles];
                    saveData();
                    console.log('üÜï Dados inicializados');
                }
            } catch (e) {
                console.error('‚ùå Erro ao carregar:', e);
                vehicles = [...initialVehicles];
            }
        }

        // FUN√á√ïES DE LOGIN
        function loginAsDriver() {
            console.log('üöõ Login como motorista - Acesso direto');
            currentRole = 'motorista';
            currentDriverName = 'Motorista';
            isLoggedIn = true;
            showMainApp();
        }

        function showSupervisorLogin() {
            document.getElementById('role-selection').style.display = 'none';
            document.getElementById('supervisor-login').style.display = 'block';
        }

        function backToRoleSelection() {
            document.getElementById('role-selection').style.display = 'block';
            document.getElementById('supervisor-login').style.display = 'none';
        }

        function loginAsSupervisor() {
            const username = document.getElementById('supervisor-username').value;
            const password = document.getElementById('supervisor-password').value;
            const supervisors = { 'Airton': '123', 'Eduardo': '2025', 'Pedro': '456' };

            if (supervisors[username] && supervisors[username] === password) {
                currentRole = 'supervisor';
                currentDriverName = username;
                isLoggedIn = true;
                showMainApp();
            } else {
                showNotification('Usu√°rio ou senha incorretos!', 'error');
            }
        }

        function logout() {
            isLoggedIn = false;
            currentRole = '';
            currentDriverName = '';
            document.getElementById('login-screen').style.display = 'flex';
            document.getElementById('main-app').style.display = 'none';
            backToRoleSelection();
        }

        function showMainApp() {
            console.log('üéØ Mostrando app para:', currentDriverName, '- Papel:', currentRole);
            document.getElementById('login-screen').style.display = 'none';
            document.getElementById('main-app').style.display = 'flex';

            const userRoleDisplay = document.getElementById('user-role-display');
            if (currentRole === 'supervisor') {
                userRoleDisplay.textContent = `üë®‚Äçüíº Supervisor - ${currentDriverName}`;
                document.getElementById('nav-vehicles').classList.remove('hidden');
                document.getElementById('action-export').style.display = 'block';
                document.getElementById('actions-header').style.display = 'table-cell';
                document.getElementById('requests-actions-header').style.display = 'table-cell';
            } else {
                userRoleDisplay.textContent = `üöõ Motorista`;
                document.getElementById('actions-header').style.display = 'none';
                document.getElementById('requests-actions-header').style.display = 'none';
            }

            updateCurrentDate();
            populateSelects();
            loadRecentActivities();
            loadAllRequests();
            loadVehicles();
            updateStats();
            showNotification(`Bem-vindo ao Sistema Rezende Energia!`, 'success');
        }

        // FUN√á√ïES DE INTERFACE
        function updateCurrentDate() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('pt-BR', {
                weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
            });
            const dateElement = document.getElementById('current-date');
            if (dateElement) dateElement.textContent = dateStr;
        }

        function populateSelects() {
            // Motoristas
            const driverSelect = document.getElementById('new-request-driver');
            if (driverSelect) {
                driverSelect.innerHTML = '<option value="">Selecione seu nome</option>';
                availableDrivers.forEach(driver => {
                    const option = document.createElement('option');
                    option.value = driver;
                    option.textContent = driver;
                    driverSelect.appendChild(option);
                });
            }

            // Ve√≠culos
            const plateSelect = document.getElementById('new-request-plate');
            if (plateSelect) {
                plateSelect.innerHTML = '<option value="">Selecione</option>';
                vehicles.forEach(vehicle => {
                    const option = document.createElement('option');
                    option.value = vehicle.plate;
                    option.textContent = vehicle.plate;
                    option.setAttribute('data-model', vehicle.model);
                    plateSelect.appendChild(option);
                });
            }

            // Cidades
            const citySelect = document.getElementById('new-request-city');
            if (citySelect) {
                citySelect.innerHTML = '<option value="">Selecione</option>';
                cities.forEach(city => {
                    const option = document.createElement('option');
                    option.value = city;
                    option.textContent = city;
                    citySelect.appendChild(option);
                });
            }

            // Postos
            const stationSelect = document.getElementById('new-request-gas-station');
            if (stationSelect) {
                stationSelect.innerHTML = '<option value="">Selecione</option>';
                gasStations.forEach(station => {
                    const option = document.createElement('option');
                    option.value = station;
                    option.textContent = station;
                    stationSelect.appendChild(option);
                });
            }

            // Combust√≠veis
            const fuelSelect = document.getElementById('new-request-fuel-type');
            if (fuelSelect) {
                fuelSelect.innerHTML = '<option value="">Selecione</option>';
                fuelTypes.forEach(fuel => {
                    const option = document.createElement('option');
                    option.value = fuel;
                    option.textContent = fuel;
                    fuelSelect.appendChild(option);
                });
            }
        }

        function updateVehicleModel() {
            const plateSelect = document.getElementById('new-request-plate');
            const modelInput = document.getElementById('new-request-vehicle-model');
            if (plateSelect && modelInput) {
                const selectedOption = plateSelect.options[plateSelect.selectedIndex];
                modelInput.value = selectedOption.getAttribute('data-model') || '';
            }
        }

        function showScreen(screenId) {
            console.log('üì∫ Mudando para tela:', screenId);
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));

            const screen = document.getElementById(screenId);
            if (screen) screen.classList.add('active');

            document.querySelectorAll('.nav-item').forEach(item => {
                if (item.onclick && item.onclick.toString().includes(screenId)) {
                    item.classList.add('active');
                }
            });

            if (screenId === 'requests') loadAllRequests();
            if (screenId === 'vehicles') loadVehicles();
        }

        function loadRecentActivities() {
            const tbody = document.getElementById('recent-activities');
            if (!tbody) return;

            let recentRequests = requests.slice(0, 5);

            if (recentRequests.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 40px;">Nenhuma requisi√ß√£o encontrada</td></tr>';
                return;
            }

            tbody.innerHTML = recentRequests.map(req => `
                <tr>
                    <td><strong>${req.id}</strong></td>
                    <td>${req.driver}</td>
                    <td>${req.vehicle}</td>
                    <td><span class="status-badge status-${req.status}">${getStatusText(req.status)}</span></td>
                    <td>${formatDate(req.date)}</td>
                    <td>
                        <button class="btn btn-small" onclick="viewRequest('${req.id}')">üëÅÔ∏è</button>
                        ${currentRole === 'supervisor' && req.status === 'pending' ? `
                            <button class="btn btn-small btn-success" onclick="approveRequest('${req.id}')">‚úÖ</button>
                            <button class="btn btn-small btn-danger" onclick="rejectRequest('${req.id}')">‚ùå</button>
                        ` : ''}
                    </td>
                </tr>
            `).join('');
        }

        function loadAllRequests() {
            const tbody = document.getElementById('all-requests');
            if (!tbody) return;

            if (requests.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center; padding: 40px;">Nenhuma requisi√ß√£o encontrada</td></tr>';
                return;
            }

            tbody.innerHTML = requests.map(req => `
                <tr>
                    <td><strong>${req.id}</strong></td>
                    <td>${req.driver}</td>
                    <td>${req.vehicle}</td>
                    <td>${req.city || 'N/A'}</td>
                    <td><span class="status-badge status-${req.status}">${getStatusText(req.status)}</span></td>
                    <td>${formatDate(req.date)}</td>
                    <td>
                        <button class="btn btn-small" onclick="viewRequest('${req.id}')">üëÅÔ∏è</button>
                        ${currentRole === 'supervisor' && req.status === 'pending' ? `
                            <button class="btn btn-small btn-success" onclick="approveRequest('${req.id}')">‚úÖ</button>
                            <button class="btn btn-small btn-danger" onclick="rejectRequest('${req.id}')">‚ùå</button>
                        ` : ''}
                    </td>
                </tr>
            `).join('');
        }

        function loadVehicles() {
            const tbody = document.getElementById('vehicles-list');
            if (!tbody) return;

            if (vehicles.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; padding: 40px;">Nenhum ve√≠culo cadastrado</td></tr>';
                return;
            }

            tbody.innerHTML = vehicles.map(vehicle => `
                <tr>
                    <td><strong>${vehicle.plate}</strong></td>
                    <td>${vehicle.model}</td>
                    <td>${vehicle.year}</td>
                    <td><span class="status-badge status-completed">${vehicle.status}</span></td>
                </tr>
            `).join('');
        }

        function updateStats() {
            document.getElementById('stat-pending').textContent = requests.filter(r => r.status === 'pending').length;
            document.getElementById('stat-signed').textContent = requests.filter(r => r.status === 'signed').length;
            document.getElementById('stat-fueled').textContent = requests.filter(r => r.status === 'fueled').length;
            document.getElementById('stat-completed').textContent = requests.filter(r => r.status === 'completed').length;
        }

        function getStatusText(status) {
            const statusMap = {
                'pending': 'Pendente',
                'signed': 'Aprovado',
                'rejected': 'Rejeitado',
                'fueled': 'Abastecido',
                'completed': 'Completo'
            };
            return statusMap[status] || status;
        }

        function formatDate(dateStr) {
            if (!dateStr) return 'N/A';
            try {
                return new Date(dateStr + 'T00:00:00').toLocaleDateString('pt-BR');
            } catch (e) {
                return dateStr;
            }
        }

        // A√á√ïES
        function newRequest() {
            document.getElementById('modal-new-request').classList.add('active');
        }

        function createRequest() {
            const driver = document.getElementById('new-request-driver').value;
            const plate = document.getElementById('new-request-plate').value;
            const model = document.getElementById('new-request-vehicle-model').value;
            const city = document.getElementById('new-request-city').value;
            const station = document.getElementById('new-request-gas-station').value;
            const fuel = document.getElementById('new-request-fuel-type').value;
            const km = document.getElementById('new-request-km').value;
            const notes = document.getElementById('new-request-notes').value;

            if (!driver || !plate || !city || !station || !fuel || !km) {
                showNotification('Preencha todos os campos obrigat√≥rios (marcados com *)!', 'error');
                return;
            }

            const newId = `REQ-2025-${String(requests.length + 1).padStart(3, '0')}`;
            const today = new Date().toISOString().split('T')[0];

            const newRequest = {
                id: newId,
                driver: driver,
                plate: plate,
                vehicle: `${model} - ${plate}`,
                city: city,
                gasStation: station,
                fuelType: fuel,
                status: 'pending',
                date: today,
                km: parseInt(km),
                notes: notes || 'Sem observa√ß√µes'
            };

            requests.unshift(newRequest);
            saveData();

            loadRecentActivities();
            loadAllRequests();
            updateStats();
            closeModal('modal-new-request');
            clearForm('new-request');

            showNotification(`Requisi√ß√£o ${newId} criada com sucesso!`, 'success');
            console.log('‚úÖ Requisi√ß√£o criada:', newRequest);
        }

        function approveRequest(reqId) {
            if (currentRole !== 'supervisor') {
                showNotification('Apenas supervisores podem aprovar!', 'error');
                return;
            }

            const request = requests.find(req => req.id === reqId);
            if (request && request.status === 'pending') {
                request.status = 'signed';
                request.supervisor = currentDriverName;
                saveData();
                loadRecentActivities();
                loadAllRequests();
                updateStats();
                showNotification(`Requisi√ß√£o ${reqId} aprovada!`, 'success');
            }
        }

        function rejectRequest(reqId) {
            if (currentRole !== 'supervisor') {
                showNotification('Apenas supervisores podem rejeitar!', 'error');
                return;
            }

            const request = requests.find(req => req.id === reqId);
            if (request && request.status === 'pending') {
                request.status = 'rejected';
                request.supervisor = currentDriverName;
                saveData();
                loadRecentActivities();
                loadAllRequests();
                updateStats();
                showNotification(`Requisi√ß√£o ${reqId} rejeitada!`, 'warning');
            }
        }

        function viewRequest(reqId) {
            const request = requests.find(req => req.id === reqId);
            if (request) {
                alert(`
üìã DETALHES DA REQUISI√á√ÉO ${reqId}
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üë§ Motorista: ${request.driver}
üöö Ve√≠culo: ${request.vehicle}
üèôÔ∏è Cidade: ${request.city}
‚õΩ Posto: ${request.gasStation}
üõ¢Ô∏è Combust√≠vel: ${request.fuelType}
üìÖ Data: ${formatDate(request.date)}
üõ£Ô∏è KM: ${request.km ? request.km.toLocaleString() : 'N/A'}
üìä Status: ${getStatusText(request.status)}
üìù Obs: ${request.notes}
                `);
            }
        }

        function filterByStatus(status) {
            if (currentRole === 'motorista') return;
            showScreen('requests');
        }

        function newVehicle() {
            if (currentRole !== 'supervisor') {
                showNotification('Apenas supervisores podem cadastrar ve√≠culos!', 'error');
                return;
            }
            document.getElementById('modal-new-vehicle').classList.add('active');
        }

        function createVehicle() {
            const plate = document.getElementById('new-vehicle-plate').value.toUpperCase();
            const model = document.getElementById('new-vehicle-model').value;
            const year = document.getElementById('new-vehicle-year').value;
            const color = document.getElementById('new-vehicle-color').value;

            if (!plate || !model || !year) {
                showNotification('Preencha todos os campos obrigat√≥rios!', 'error');
                return;
            }

            if (vehicles.find(v => v.plate === plate)) {
                showNotification('J√° existe um ve√≠culo com essa placa!', 'error');
                return;
            }

            const newVehicle = {
                plate: plate,
                model: `${model} ${year}`,
                year: year,
                status: 'Ativo',
                color: color || 'N/A'
            };

            vehicles.push(newVehicle);
            saveData();
            loadVehicles();
            populateSelects();
            closeModal('modal-new-vehicle');
            clearForm('new-vehicle');
            showNotification(`Ve√≠culo ${plate} cadastrado!`, 'success');
        }

        function exportToExcel() {
            if (currentRole !== 'supervisor') {
                showNotification('Apenas supervisores podem exportar!', 'error');
                return;
            }

            if (requests.length === 0) {
                showNotification('N√£o h√° dados para exportar!', 'warning');
                return;
            }

            try {
                const workbook = XLSX.utils.book_new();

                const requestsData = requests.map(req => ({
                    'ID': req.id,
                    'Motorista': req.driver,
                    'Ve√≠culo': req.vehicle,
                    'Cidade': req.city || 'N/A',
                    'Posto': req.gasStation || 'N/A',
                    'Combust√≠vel': req.fuelType || 'N/A',
                    'Status': getStatusText(req.status),
                    'Data': req.date,
                    'KM': req.km || 'N/A',
                    'Observa√ß√µes': req.notes || ''
                }));

                const reqWs = XLSX.utils.json_to_sheet(requestsData);
                XLSX.utils.book_append_sheet(workbook, reqWs, "Requisi√ß√µes");

                const vehiclesData = vehicles.map(vehicle => ({
                    'Placa': vehicle.plate,
                    'Modelo': vehicle.model,
                    'Ano': vehicle.year,
                    'Cor': vehicle.color || 'N/A',
                    'Status': vehicle.status
                }));

                const vehiclesWs = XLSX.utils.json_to_sheet(vehiclesData);
                XLSX.utils.book_append_sheet(workbook, vehiclesWs, "Ve√≠culos");

                const filename = `relatorio_rezende_energia_${new Date().toISOString().split('T')[0]}.xlsx`;
                XLSX.writeFile(workbook, filename);

                showNotification(`Arquivo ${filename} exportado com sucesso!`, 'success');
            } catch (error) {
                console.error('‚ùå Erro ao exportar:', error);
                showNotification('Erro ao exportar: ' + error.message, 'error');
            }
        }

        // UTILIT√ÅRIOS
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function clearForm(prefix) {
            document.querySelectorAll(`[id^="${prefix}"]`).forEach(input => {
                if (input.type === 'text' || input.type === 'number' || input.tagName === 'TEXTAREA') {
                    input.value = '';
                } else if (input.tagName === 'SELECT') {
                    input.selectedIndex = 0;
                }
            });
        }

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            setTimeout(() => notification.classList.remove('show'), 4000);
        }

        // INICIALIZA√á√ÉO
        document.addEventListener('DOMContentLoaded', function() {
            console.log('‚úÖ Sistema Rezende Energia v3.2.0 inicializado');
            loadData();
            
            setInterval(() => {
                if (isLoggedIn) {
                    saveData();
                }
            }, 30000);
        });
    </script>
</body>
</html>
